<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MiraiPalette.Maui.Pages.PaletteDetailPage"
             xmlns:pages="clr-namespace:MiraiPalette.Maui.PageModels"
             xmlns:models="clr-namespace:MiraiPalette.Maui.Models"
             xmlns:controls="clr-namespace:MiraiPalette.Maui.Pages.Controls;assembly=MiraiPalette.Maui"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="pages:PaletteDetailPageModel"
             xmlns:icons="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:attached="clr-namespace:MiraiPalette.Maui.AttachedProperties"
             xmlns:behaviors="clr-namespace:MiraiPalette.Maui.Behaviors;assembly=MiraiPalette.Maui"
             x:Name="_page"
             Title="" Shell.NavBarIsVisible="False" >
    <ContentPage.Resources>
        <Style TargetType="Entry" x:Key="NameDescriptionEntryStyle">
            <Setter Property="Keyboard" Value="Text"/>
            <Setter Property="IsSpellCheckEnabled" Value="False"/>
            <Setter Property="ClearButtonVisibility" Value="WhileEditing"/>
            <Setter Property="ReturnType" Value="Done"/>
            <Setter Property="HorizontalOptions" Value="Start"/>
        </Style>
        <Style TargetType="Button" x:Key="NameDescriptionButtonStyle">
            <Setter Property="BackgroundColor" Value="Transparent"/>
            <Setter Property="LineBreakMode" Value="TailTruncation"/>
            <Setter Property="ToolTipProperties.Text" Value="Click to edit"/>
            <Setter Property="HorizontalOptions" Value="Start"/>
        </Style>
        <Style TargetType="Border" x:Key="IconButtonBorderStyle">
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Dark={StaticResource Gray600}}"/>
            <Setter Property="VerticalOptions" Value="Center"/>
            <Setter Property="StrokeThickness" Value="0"/>
            <Setter Property="StrokeShape" Value="RoundRectangle 5"/>
            <Setter Property="Padding" Value="10,5"/>
            <!--<Setter Property="WidthRequest" Value="32"/>
            <Setter Property="HeightRequest" Value="32"/>-->            
            <Setter Property="attached:Touch.HoveredBackgroundColor" Value="{AppThemeBinding Dark={StaticResource Gray500}}"/>
        </Style>
        <Style TargetType="icons:MauiIcon" x:Key="IconButtonMauiIconStyle">
            <Setter Property="BackgroundColor" Value="Transparent"/>
            <Setter Property="HorizontalOptions" Value="Center"/>
            <Setter Property="VerticalOptions" Value="Center"/>
            <Setter Property="IconSuffixFontSize" Value="16"/>
        </Style>

        <toolkit:MultiConverter x:Key="IsSelectedColorToStorkeConverter">
            <toolkit:IsEqualConverter/>
            <toolkit:BoolToObjectConverter TrueObject="{StaticResource PrimaryDarkBrush}}" FalseObject="{StaticResource TransparentBrush}"/>
        </toolkit:MultiConverter>
        <x:Array x:Key="IsSelectedColorToStorkeConverterParameters" Type="{x:Type toolkit:MultiConverterParameter}">
            <toolkit:MultiConverterParameter ConverterType="{x:Type toolkit:IsEqualConverter}" Value="{Binding SelectedExistColor}"/>
            <toolkit:MultiConverterParameter ConverterType="{x:Type toolkit:BoolToObjectConverter}" />
        </x:Array>
        <toolkit:IsNotNullConverter x:Key="IsNotNullConverter"/>
    </ContentPage.Resources>
    <Grid ColumnDefinitions="*,Auto">
        <Grid RowDefinitions="Auto,*" Padding="10" RowSpacing="10">
            <Grid ColumnDefinitions="*,Auto">
                <VerticalStackLayout>
                    <Button x:Name="_nameButton" FontAttributes="Bold" Text="{Binding Name}" TextColor="{StaticResource PrimaryDark}" FontSize="Title" Style="{StaticResource NameDescriptionButtonStyle}" >
                        <Button.Behaviors>
                            <behaviors:ButtonSwitchToEntryBehavior SwitchTo="{x:Reference _nameEntry}"/>
                        </Button.Behaviors>
                    </Button>
                    <Entry Placeholder="Name" x:Name="_nameEntry" Style="{StaticResource NameDescriptionEntryStyle}" Text="{Binding Name}" FontSize="Title"  Margin="0,5" TextColor="{StaticResource PrimaryDark}"/>
                    <Button x:Name="_descriptionButton" Text="{Binding Description}" Style="{StaticResource NameDescriptionButtonStyle}" TextColor="{AppThemeBinding Dark={StaticResource Gray300}}" FontSize="Body">
                        <Button.Behaviors>
                            <behaviors:ButtonSwitchToEntryBehavior SwitchTo="{x:Reference _descriptionEntry}"/>
                        </Button.Behaviors>
                    </Button>
                    <Entry x:Name="_descriptionEntry" Style="{StaticResource NameDescriptionEntryStyle}" Text="{Binding Description}" Placeholder="Description" FontSize="Body" />
                </VerticalStackLayout>
                <HorizontalStackLayout Grid.Column="1" Padding="10" Spacing="10">
                    <Border Style="{StaticResource IconButtonBorderStyle}">
                        <icons:MauiIcon Style="{StaticResource IconButtonMauiIconStyle}" Icon="{icons:Fluent Icon=Add28}" attached:TapGesture.Command="{Binding AddNewColorCommand}" IconSuffix="Add new color"/>
                    </Border>
                    <Border Style="{StaticResource IconButtonBorderStyle}" >
                        <icons:MauiIcon Style="{StaticResource IconButtonMauiIconStyle}" Icon="{icons:Fluent Icon=Delete28}" attached:TapGesture.Command="{Binding DeletePaletteCommand}" IconColor="{StaticResource Error}" IconSuffixTextColor="{StaticResource Error}" IconSuffix="Delete Palette"/>
                    </Border>
                </HorizontalStackLayout>
            </Grid>
            <ScrollView Grid.Row="1">
                <FlexLayout AlignItems="Center" AlignContent="Start" Wrap="Wrap" BindableLayout.ItemsSource="{Binding Colors}" >
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:MiraiColor">
                            <Border Stroke="{AppThemeBinding Dark={StaticResource PrimaryDarkBrush}}" StrokeShape="RoundRectangle 5" BackgroundColor="{AppThemeBinding Dark={StaticResource Gray600}}" StrokeThickness="0" Margin="1" Padding="1">
                                <controls:ColorView WidthRequest="200" HeightRequest="200"/>
                                <Border.Behaviors>
                                    <toolkit:TouchBehavior HoveredBackgroundColor="{AppThemeBinding Dark={StaticResource Gray500}}" />
                                </Border.Behaviors>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="ColorItemTapped" Buttons="Primary" Command="{Binding OpenColorDetailCommand,Source={RelativeSource AncestorType={x:Type pages:PaletteDetailPageModel}}}" CommandParameter="{Binding .}"/>
                                </Border.GestureRecognizers>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </ScrollView>
        </Grid>
        <Border Grid.Column="1" WidthRequest="300" StrokeThickness="0" Padding="10"  IsVisible="{Binding IsColorDetailOpen}" BackgroundColor="{AppThemeBinding Dark={StaticResource Gray600}}">
            <Grid RowDefinitions="Auto,*,Auto">
                <Border Padding="5" Style="{StaticResource IconButtonBorderStyle}" HorizontalOptions="End" attached:TapGesture.Command="{Binding CloseColorDetailCommand}">
                    <icons:MauiIcon Style="{StaticResource IconButtonMauiIconStyle}" Icon="{icons:Fluent Icon=Dismiss24}"/>
                </Border>
                <ScrollView Grid.Row="1">
                    <VerticalStackLayout Spacing="10">
                        <Button x:Name="_colorNameButton" HorizontalOptions="Start" BackgroundColor="Transparent" TextColor="{AppThemeBinding Dark={StaticResource White}}" Text="{Binding CurrentColorName}" FontSize="Medium">
                            <Button.Behaviors>
                                <behaviors:ButtonSwitchToEntryBehavior SwitchTo="{x:Reference _colorNameEntry}"/>
                            </Button.Behaviors>
                        </Button>
                        <Entry x:Name="_colorNameEntry" Style="{StaticResource NameDescriptionEntryStyle}" FontSize="Medium" Text="{Binding CurrentColorName}"/>
                        <controls:ColorPicker Color="{Binding CurrentColorValue}"/>
                    </VerticalStackLayout>
                </ScrollView>
                <VerticalStackLayout Grid.Row="2" Spacing="10">
                    <Border Style="{StaticResource IconButtonBorderStyle}" attached:TapGesture.Command="{Binding SaveColorDetailCommand}" BackgroundColor="{AppThemeBinding Dark={StaticResource Success}}" >
                        <icons:MauiIcon Style="{StaticResource IconButtonMauiIconStyle}" Icon="{icons:Fluent Icon=Save24}"  IconSuffix="Save"/>
                    </Border>
                    <Border Style="{StaticResource IconButtonBorderStyle}" attached:TapGesture.Command="{Binding DeleteSelectedColorCommand}" BackgroundColor="{AppThemeBinding Dark={StaticResource Error}}" >
                        <icons:MauiIcon Style="{StaticResource IconButtonMauiIconStyle}" Icon="{icons:Fluent Icon=Delete24}" IconSuffix="Delete"/>
                    </Border>
                </VerticalStackLayout>
            </Grid>
        </Border>
        
    </Grid>

</ContentPage>